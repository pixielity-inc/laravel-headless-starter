#!/usr/bin/env php
<?php

/**
 * Laravel Binary Wrapper
 *
 * This is an alternative entry point for Laravel's Artisan console that can be
 * placed in the system PATH for global access. It's functionally identical to
 * the artisan file in the project root.
 *
 * Installation:
 *   1. Make executable: chmod +x bin/laravel
 *   2. Add to PATH: export PATH="$PATH:/path/to/project/bin"
 *   3. Use globally: laravel [command]
 *
 * Usage:
 *   laravel list                  - List all available commands
 *   laravel migrate               - Run database migrations
 *   laravel tinker                - Interact with your application
 *   laravel octane:start          - Start Octane server
 *
 * Note:
 *   This file should be kept in sync with the root artisan file.
 *   Any changes to artisan should be reflected here.
 *
 * @package Laravel
 * @author  Taylor Otwell <taylor@laravel.com>
 * @link    https://laravel.com/docs/12.x/artisan
 * @since   Laravel 1.0
 */

declare(strict_types=1);

use Illuminate\Foundation\Application;
use Symfony\Component\Console\Input\ArgvInput;

/*
 * |--------------------------------------------------------------------------
 * | Register The Auto Loader
 * |--------------------------------------------------------------------------
 * |
 * | Composer provides a convenient, automatically generated class loader
 * | for our application. We just need to utilize it! We'll require it
 * | into the script here so that we don't have to worry about the
 * | loading of any of our classes manually.
 * |
 */

/** @var array<int, string> List of possible autoloader locations */
$autoloadPaths = [
    __DIR__ . '/../vendor/autoload.php',  // App-level vendor (if exists)
    __DIR__ . '/../../../vendor/autoload.php',  // Monorepo root vendor
];

$autoloaderFound = false;

foreach ($autoloadPaths as $autoloadPath) {
    if (file_exists($autoloadPath)) {
        require_once $autoloadPath;
        $autoloaderFound = true;
        break;
    }
}

if (!$autoloaderFound) {
    fwrite(STDERR, "Error: Composer autoloader not found.\n");
    fwrite(STDERR, "Please run: composer install\n");
    exit(1);
}

/*
 * |--------------------------------------------------------------------------
 * | Define Application Start Time
 * |--------------------------------------------------------------------------
 * |
 * | Record the start time of the application for performance monitoring.
 * | The LARAVEL_START constant is available throughout the application.
 * |
 */

define('LARAVEL_START', microtime(true));

/*
 * |--------------------------------------------------------------------------
 * | Bootstrap The Application
 * |--------------------------------------------------------------------------
 * |
 * | Bootstrap the Laravel application and prepare it to handle console
 * | commands. This loads all service providers and configuration.
 * |
 */

/** @var Application $app */
$app = require_once __DIR__ . '/../bootstrap/app.php';

/*
 * |--------------------------------------------------------------------------
 * | Run The Artisan Application
 * |--------------------------------------------------------------------------
 * |
 * | Execute the current CLI command and return the status code.
 * |
 */

$status = $app->handleCommand(new ArgvInput);

/*
 * |--------------------------------------------------------------------------
 * | Shutdown The Application
 * |--------------------------------------------------------------------------
 * |
 * | Fire shutdown events and exit with the command status code.
 * |
 */

exit($status);
